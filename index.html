<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Chat ðŸ’¬</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.chat-container {
    background: #fff;
    width: 100%;
    max-width: 420px;
    height: 650px;
    display: flex;
    flex-direction: column;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    overflow: hidden;
}

.chat-header {
    background: #6a5acd;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
}

.chat-box {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    background: #e8eaf6;
    scroll-behavior: smooth;
    display: flex;
    flex-direction: column;
}

.chat-message {
    margin-bottom: 12px;
    padding: 10px 14px;
    border-radius: 15px;
    max-width: 75%;
    word-wrap: break-word;
    position: relative;
    display: flex;
    flex-direction: column;
}

.chat-message.self {
    background: #6a5acd;
    color: white;
    align-self: flex-end;
    border-radius: 15px 15px 0 15px;
}

.chat-message.other {
    background: #d1c4e9;
    color: #000;
    align-self: flex-start;
    border-radius: 15px 15px 15px 0;
}

.chat-message span.name {
    font-weight: bold;
    margin-bottom: 3px;
}

.chat-message span.time {
    font-size: 11px;
    color: #444;
    margin-top: 3px;
    text-align: right;
}

.chat-message.self span.time {
    color: #ddd;
}

.chat-btns {
    margin-top: 5px;
    display: flex;
    justify-content: flex-end;
    gap: 5px;
}

.chat-btns button {
    padding: 3px 6px;
    font-size: 11px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
    transition: 0.2s;
}

.chat-btns button.edit {
    background: #4caf50;
    color: #fff;
}

.chat-btns button.delete {
    background: #f44336;
    color: #fff;
}

.chat-btns button:hover {
    opacity: 0.8;
}

.chat-form {
    display: flex;
    border-top: 1px solid #ccc;
}

.chat-form input {
    flex: 1;
    padding: 12px;
    border: none;
    outline: none;
    font-size: 16px;
    border-radius: 0;
}

.chat-form button {
    padding: 0 20px;
    border: none;
    background: #6a5acd;
    color: white;
    cursor: pointer;
    font-size: 16px;
    transition: 0.2s;
}

.chat-form button:hover {
    background: #5b48b2;
}
</style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">Online Chat ðŸ’¬</div>
    <div id="chat-box" class="chat-box"></div>
    <form id="chat-form" class="chat-form">
        <input type="text" id="message-input" placeholder="Type a message..." required>
        <button type="submit">Send</button>
    </form>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyAb3XQPGpk143SPX9JmhUHpXkACxBb8LY0",
  authDomain: "chat-online-2aeaf.firebaseapp.com",
  databaseURL: "https://chat-online-2aeaf-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "chat-online-2aeaf",
  storageBucket: "chat-online-2aeaf.firebasestorage.app",
  messagingSenderId: "817572486888",
  appId: "1:817572486888:web:21271cfaf54849b659f35d",
  measurementId: "G-CLG4BWY6RH"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Clean old messages (optional) =====
db.ref('messages').remove();

// ===== Ask user for name =====
let userName = '';
while(!userName) {
    userName = prompt("Enter your name:");
}

// ===== Select Elements =====
const chatForm = document.getElementById('chat-form');
const chatBox = document.getElementById('chat-box');
const messageInput = document.getElementById('message-input');

// ===== Generate color for each username =====
function getColor(name) {
    let hash = 0;
    for (let i = 0; i < name.length; i++) {
        hash = name.charCodeAt(i) + ((hash << 5) - hash);
    }
    return `hsl(${hash % 360}, 70%, 50%)`;
}

// ===== Format timestamp =====
function formatTime(ms) {
    const date = new Date(ms);
    let hours = date.getHours();
    const minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    if(hours === 0) hours = 12;
    return `${hours}:${minutes.toString().padStart(2,'0')} ${ampm}`;
}

// ===== Send message =====
chatForm.addEventListener('submit', e => {
    e.preventDefault();
    const message = messageInput.value.trim();
    if(message){
        const msgData = { 
            text: message, 
            name: userName,
            time: Date.now()
        };
        db.ref('messages').push(msgData);
        messageInput.value = '';
    }
});

// ===== Render message =====
function renderMessage(key, data) {
    const messageEl = document.createElement('div');
    messageEl.classList.add('chat-message');
    messageEl.classList.add(data.name === userName ? 'self' : 'other');

    const nameSpan = document.createElement('span');
    nameSpan.classList.add('name');
    nameSpan.textContent = data.name;
    nameSpan.style.color = getColor(data.name);

    const textNode = document.createTextNode(data.text);

    const timeSpan = document.createElement('span');
    timeSpan.classList.add('time');
    timeSpan.textContent = formatTime(data.time);

    messageEl.appendChild(nameSpan);
    messageEl.appendChild(textNode);
    messageEl.appendChild(timeSpan);

    // Only add buttons for user's own messages
    if(data.name === userName){
        const btnContainer = document.createElement('div');
        btnContainer.classList.add('chat-btns');

        const editBtn = document.createElement('button');
        editBtn.textContent = "Edit";
        editBtn.classList.add('edit');
        editBtn.onclick = () => {
            const newText = prompt("Edit your message:", data.text);
            if(newText !== null && newText.trim() !== ''){
                db.ref('messages/'+key).update({text: newText});
            }
        };

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = "Delete";
        deleteBtn.classList.add('delete');
        deleteBtn.onclick = () => {
            if(confirm("Delete this message?")){
                db.ref('messages/'+key).remove();
            }
        };

        btnContainer.appendChild(editBtn);
        btnContainer.appendChild(deleteBtn);
        messageEl.appendChild(btnContainer);
    }

    chatBox.appendChild(messageEl);
    chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
}

// ===== Listen for messages =====
db.ref('messages').on('child_added', snapshot => {
    renderMessage(snapshot.key, snapshot.val());
});

db.ref('messages').on('child_changed', snapshot => {
    chatBox.innerHTML = '';
    db.ref('messages').once('value', snap => {
        snap.forEach(child => renderMessage(child.key, child.val()));
    });
});

db.ref('messages').on('child_removed', snapshot => {
    chatBox.innerHTML = '';
    db.ref('messages').once('value', snap => {
        snap.forEach(child => renderMessage(child.key, child.val()));
    });
});
</script>

</body>
</html>